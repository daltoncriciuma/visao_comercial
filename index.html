<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Visão Comercial</title>
<style>
  :root { color-scheme: dark; }
  html, body {
    margin:0; padding:0; width:100vw; height:100vh; overflow:hidden;
    background:#000; color:#fff; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  }

  /* Área central escalada para caber (base 768x1152 = 2:3) */
  .stage { position:fixed; inset:0; display:grid; place-items:center; }
  .box   { width:768px; height:1152px; position:relative; transform-origin:50% 50%; }

  /* Camadas */
  .mask-box, .overlay, .liquidLayer { position:absolute; inset:0; width:100%; height:100%; }
  .overlay { object-fit:contain; pointer-events:none; }
  .overlay[onerror] { font-size:0; } /* evita ALT aparecer se imagem falhar */

  /* Máscara PNG recorta o líquido + clip extra pra garantir não vazar */
  .mask-box{
    -webkit-mask:url("./img/mask.png") center / contain no-repeat;
            mask:url("./img/mask.png") center / contain no-repeat;
  }
  .liquid{
    position:absolute; left:0; right:0; bottom:0;
    height:0%;
    background:linear-gradient(#6bb8ff,#1976d2);
    border-top:4px solid rgba(255,255,255,.55);
    transition:height .9s cubic-bezier(.2,.7,.2,1);
    will-change:height;
    /* CLIP extra em formato de garrafa (trapezoide) - ajuste fino se precisar */
    clip-path: polygon(
      30% 20%, 70% 20%, 78% 100%, 22% 100%
    );
  }

  /* Rótulos */
  .labelInside{
    position:absolute; left:50%; top:100%; transform:translate(-50%,-50%);
    font-weight:800; font-size:32px; text-shadow:0 2px 10px rgba(0,0,0,.35);
  }
  .labelTop{
    position:absolute; left:50%; top:10%; transform:translateX(-50%);
    font-weight:800; font-size:28px; opacity:.95; text-shadow:0 2px 10px rgba(0,0,0,.35);
  }
  .labelSide{
    position:absolute; right:-56px; top:50%; transform:translateY(-50%);
    font-weight:800; font-size:22px; opacity:.95;
  }

  /* HUD (zoom e recarregar) */
  .hud{
    position:fixed; right:12px; bottom:12px; display:flex; gap:10px; align-items:center;
    background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.15);
    padding:8px 12px; border-radius:12px; font-size:14px; backdrop-filter:blur(4px);
  }
  .btn{ cursor:pointer; border:1px solid rgba(255,255,255,.25);
    background:rgba(255,255,255,.08); padding:6px 10px; border-radius:8px; font-weight:600; }
  .btn:hover{ background:rgba(255,255,255,.15); }
  .muted{ opacity:.8 }
</style>
</head>
<body>
  <div class="stage">
    <div class="box" id="box">
      <!-- rótulos -->
      <div class="labelTop" id="labelTop">30</div>
      <div class="labelInside" id="labelInside">0,00</div>
      <div class="labelSide" id="labelSide">0%</div>

      <!-- máscara + líquido -->
      <div class="mask-box">
        <div class="liquid" id="liquid"></div>
      </div>

      <!-- frasco por cima; se falhar, some (sem ALT na tela) -->
      <img class="overlay" id="bottle" alt="" src="./img/bottle.png"
           onerror="this.style.display='none'" />
    </div>
  </div>

  <!-- HUD -->
  <div class="hud">
    <button class="btn" id="zoomOut">−</button>
    <button class="btn" id="zoomReset">100%</button>
    <button class="btn" id="zoomIn">+</button>
    <button class="btn" id="reloadBtn">Recarregar</button>
    <span class="muted" id="stamp">—</span>
  </div>

<script>
  /* ===== CONFIG ===== */
  // Seu link convertido para CSV (mesmo gid=256356509)
  const DATA_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vR24Vx4SCLyGxtnD8X0tYOnBIZJ_Y10BYhYwaESp2Sui60TTEgC13hvPO8vKNtiMYp35L-A9LcGNmHB/pub?gid=256356509&output=csv";

  const PONTOS_MAX = 30;
  const AUTO_RELOAD_MIN = 5;      // minutos (0 = desliga)
  const PERCENT_DEFAULT = 0.44;   // fallback se CSV falhar
  const BASE_W = 768, BASE_H = 1152;

  // Fit-to-screen + zoom
  let userZoom = 1.00, ZOOM_STEP = 0.08;
  function fit(){
    const vw = window.innerWidth, vh = window.innerHeight;
    const k = Math.min(vw/BASE_W, vh/BASE_H) * userZoom;
    document.getElementById("box").style.transform = `scale(${k})`;
    document.getElementById("zoomReset").textContent = Math.round(userZoom*100)+"%";
  }
  function zoomIn(){ userZoom=Math.min(2.5, +(userZoom+ZOOM_STEP).toFixed(2)); fit(); }
  function zoomOut(){ userZoom=Math.max(0.5, +(userZoom-ZOOM_STEP).toFixed(2)); fit(); }
  function zoomReset(){ userZoom=1.00; fit(); }

  document.getElementById("zoomIn").onclick=zoomIn;
  document.getElementById("zoomOut").onclick=zoomOut;
  document.getElementById("zoomReset").onclick=zoomReset;
  document.getElementById("reloadBtn").onclick=load;
  window.addEventListener("resize", fit);
  window.addEventListener("keydown", e=>{
    if(e.key==="+") zoomIn();
    if(e.key==="-"||e.key==="−") zoomOut();
    if(e.key==="0") zoomReset();
    if(e.key.toLowerCase()==="r") load();
  });

  // Converte vírgula/ponto, pega 1º número
  async function fetchPercent(){
    try{
      const url = DATA_CSV_URL + (DATA_CSV_URL.includes("?")?"&":"?") + "cb=" + Date.now();
      const txt = await fetch(url).then(r=>r.text());
      const m = txt.match(/-?\d+([.,]\d+)?/);
      const n = m ? parseFloat(m[0].replace(",", ".")) : NaN;
      if (isFinite(n)) return Math.max(0, Math.min(1, n));
    }catch(_){}
    return null;
  }

  // Atualiza nível e rótulos
  function setLevel(p){
    p = Math.max(0, Math.min(1, p));

    // Altura do líquido
    const h = p*100; // %
    const liquid = document.getElementById("liquid");
    liquid.style.height = h + "%";

    // Rótulo central (pontos) — no centro do azul
    const pts = (p*PONTOS_MAX);
    const inside = document.getElementById("labelInside");
    inside.textContent = pts.toFixed(2).replace(".", ",");

    // posição vertical: centro do líquido ⇒ top = 100% - h/2
    inside.style.top = (100 - h/2) + "%";

    // Rótulo de topo (total = 30) — já está fixo via CSS top:10%

    // Rótulo lateral (percentual), alinhado com a “linha d’água”
    const pct = (p*100).toFixed(2).replace(".", ",");
    const side = document.getElementById("labelSide");
    side.textContent = pct + "%";
    side.style.top = (100 - h) + "%"; // linha d’água

    // Carimbo de atualização
    const n=new Date(), two=x=>String(x).padStart(2,"0");
    document.getElementById("stamp").textContent = `Atualizado: ${two(n.getHours())}:${two(n.getMinutes())}`;
  }

  async function load(){
    const p = await fetchPercent();
    setLevel(p==null ? PERCENT_DEFAULT : p);
  }

  // start
  fit(); load();
  if (AUTO_RELOAD_MIN>0) setInterval(load, AUTO_RELOAD_MIN*60*1000);
</script>
</body>
</html>
