<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dashboards H2O - Rotação</title>
  <style>
    :root { --bg:#000; --fg:#fff; --muted:#9aa0a6; --glass:rgba(0,0,0,.42); }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    /* SEM tarja no topo — tela 100% para o iframe */
    #stage{position:fixed;inset:0}
    iframe{position:absolute;inset:0;border:0;width:100%;height:100%;background:linear-gradient(180deg,#111,#000)}

    /* Controles visíveis no rodapé */
    #controls{
      position:fixed;left:50%;bottom:14px;transform:translateX(-50%);
      display:flex;align-items:center;gap:10px;z-index:10;
      background:var(--glass);backdrop-filter:saturate(140%) blur(6px);
      padding:8px 12px;border-radius:12px;font-size:14px;user-select:none
    }
    #controls button, #controls select{
      border:0;outline:0;background:transparent;color:var(--fg);font:inherit;cursor:pointer
    }
    #controls button{
      padding:6px 10px;border-radius:10px
    }
    #controls button:hover{background:rgba(255,255,255,.08)}
    #controls select{
      background:rgba(0,0,0,.25);padding:6px 26px 6px 10px;border-radius:10px;appearance:none
    }
    #info{opacity:.8;font-size:12px;margin-left:6px}
  </style>
</head>
<body>
  <div id="stage"></div>

  <!-- Controles -->
  <div id="controls" aria-label="Controles de rotação">
    <button id="prevBtn" title="Anterior (←)">◀</button>
    <button id="toggleBtn" title="Pausar/Retomar (Espaço)">⏯</button>
    <button id="nextBtn" title="Próximo (→)">▶</button>
    <label style="display:flex;align-items:center;gap:6px;margin-left:8px">
      <span style="opacity:.8">Tempo</span>
      <select id="intervalSel" title="Intervalo entre trocas">
        <option value="30000">30s</option>
        <option value="45000">45s</option>
        <option value="60000" selected>60s</option>
        <option value="90000">90s</option>
        <option value="120000">120s</option>
      </select>
    </label>
    <span id="info"></span>
  </div>

  <script>
    // ====== CONFIG ======
    const dashboards = [
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vQabryl5zw9NO6AkZT4MIv3ZVzN33M4taW_VoIDRyouzS1bKUhSHjFu9hkTGIInpJdn5zXJbJiPm3OK/pubhtml?gid=915060596&single=true&widget=true&headers=false",
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vR24Vx4SCLyGxtnD8X0tYOnBIZJ_Y10BYhYwaESp2Sui60TTEgC13hvPO8vKNtiMYp35L-A9LcGNmHB/pubhtml?gid=74611085&single=true&widget=true&headers=false",
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vTRiAUmq-3rdKt0gdiiH2U0c06Lum3hx44s5dMYLFKQLEzbnv7gCh65WkKWtu1SEwnoGRHOcTynIMnw/pubhtml?gid=915060596&single=true&widget=true&headers=false"
    ];
    // ====== FIM CONFIG ======

    const qs = new URLSearchParams(location.search);
    const stage = document.getElementById("stage");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    const toggleBtn = document.getElementById("toggleBtn");
    const intervalSel = document.getElementById("intervalSel");
    const infoEl = document.getElementById("info");

    // permite definir tempo pela URL, ex.: ?t=90
    const qsSeconds = parseInt(qs.get("t"),10);
    if (!isNaN(qsSeconds)) {
      const ms = Math.max(5, qsSeconds) * 1000;
      [...intervalSel.options].forEach(o => o.selected = (+o.value === ms));
    }

    let idx = -1, timer = null, currentFrame = null, paused = false;

    function updateInfo(){
      infoEl.textContent = ` ${idx+1}/${dashboards.length} ${paused ? "— pausado" : ""}`;
    }

    function loadDashboard(i){
      const src = dashboards[i];
      const iframe = document.createElement("iframe");
      iframe.referrerPolicy = "no-referrer";
      iframe.loading = "eager";
      iframe.src = src;

      if (currentFrame) stage.removeChild(currentFrame);
      stage.appendChild(iframe);
      currentFrame = iframe;
      updateInfo();
    }

    function next(){
      idx = (idx + 1) % dashboards.length;
      loadDashboard(idx);
    }
    function prev(){
      idx = (idx - 1 + dashboards.length) % dashboards.length;
      loadDashboard(idx);
    }

    function getIntervalMs(){ return parseInt(intervalSel.value, 10) || 60000; }

    function startTimer(){
      clearInterval(timer);
      timer = setInterval(next, getIntervalMs());
    }

    function pause(){
      paused = true; clearInterval(timer); updateInfo();
      toggleBtn.textContent = "▶"; toggleBtn.title = "Retomar (Espaço)";
    }
    function resume(){
      paused = false; updateInfo(); startTimer();
      toggleBtn.textContent = "⏸"; toggleBtn.title = "Pausar (Espaço)";
    }
    function toggle(){ paused ? resume() : pause(); }

    // Controles
    nextBtn.onclick = () => { next(); if (!paused) startTimer(); };
    prevBtn.onclick = () => { prev(); if (!paused) startTimer(); };
    toggleBtn.onclick = toggle;
    intervalSel.onchange = () => { if (!paused) startTimer(); };

    // Atalhos de teclado
    document.addEventListener("keydown", (e) => {
      if (e.code === "Space"){ e.preventDefault(); toggle(); }
      if (e.code === "ArrowRight"){ next(); if (!paused) startTimer(); }
      if (e.code === "ArrowLeft"){ prev(); if (!paused) startTimer(); }
    });

    // Init
    if (dashboards.length){
      next();            // carrega o primeiro
      resume();          // inicia rotação e deixa botão como "⏸"
    } else {
      infoEl.textContent = "Sem dashboards configurados";
    }
  </script>
</body>
</html>
