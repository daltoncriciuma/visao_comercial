<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Visão Comercial</title>
<style>
  :root { color-scheme: dark; }
  html, body { margin:0; width:100vw; height:100vh; overflow:hidden; background:#000; color:#fff;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; }

  /* Área base 768×1152 (2:3), escalada para caber */
  .stage { position:fixed; inset:0; display:grid; place-items:center; }
  .box   { position:relative; width:768px; height:1152px; transform-origin:50% 50%; }

  /* Camadas (ordem/z-index) */
  .layer { position:absolute; inset:0; }
  .layer-liquid { z-index: 2; }
  .layer-outline{ z-index: 3; pointer-events:none; }
  .layer-labels { z-index: 4; pointer-events:none; }

  /* Máscara PNG recorta o líquido; se a imagem faltar, ainda temos o clip extra (SVG) */
  .mask-box{
    -webkit-mask:url("./img/mask.png") center / contain no-repeat;
            mask:url("./img/mask.png") center / contain no-repeat;
  }
  .liquid{
    position:absolute; left:0; right:0; bottom:0;
    height:0%; /* controlado via JS */
    background:linear-gradient(#6bb8ff,#1976d2);
    border-top:4px solid rgba(255,255,255,.55);
    transition:height .9s cubic-bezier(.2,.7,.2,1);
    will-change:height;
    /* clip extra em formato de garrafa para garantir que não ultrapasse a borda */
    clip-path: polygon(30% 20%, 70% 20%, 78% 100%, 22% 100%);
  }

  /* Contorno do frasco (sempre visível) */
  .outline-path{
    fill:none; stroke:#cfe8ff; stroke-width:8; stroke-linejoin:round;
    filter: drop-shadow(0 10px 30px rgba(25,118,210,.25));
  }

  /* Rótulos */
  .labelTop{
    position:absolute; left:50%; top:8%; transform:translateX(-50%);
    font-weight:800; font-size:28px; text-shadow:0 2px 10px rgba(0,0,0,.35);
  }
  .labelInside{
    position:absolute; left:50%; transform:translate(-50%,-50%);
    font-weight:800; font-size:32px; text-shadow:0 2px 10px rgba(0,0,0,.35);
  }
  .labelSide{
    position:absolute; right:-56px; transform:translateY(-50%);
    font-weight:800; font-size:22px;
  }

  /* HUD (zoom / recarregar) */
  .hud{ position:fixed; right:12px; bottom:12px; display:flex; gap:10px; align-items:center;
    background:rgba(0,0,0,.55); border:1px solid rgba(255,255,255,.15);
    padding:8px 12px; border-radius:12px; font-size:14px; backdrop-filter:blur(4px); }
  .btn{ cursor:pointer; border:1px solid rgba(255,255,255,.25);
    background:rgba(255,255,255,.08); padding:6px 10px; border-radius:8px; font-weight:600; }
  .btn:hover{ background:rgba(255,255,255,.15); }
  .muted{ opacity:.8 }
</style>
</head>
<body>
  <div class="stage">
    <div class="box" id="box">
      <!-- líquido (mascarado) -->
      <div class="layer layer-liquid">
        <div class="mask-box">
          <div id="liquid" class="liquid"></div>
        </div>
      </div>

      <!-- contorno vetorial alinhado -->
      <svg class="layer layer-outline" viewBox="0 0 768 1152" aria-hidden="true">
        <!-- caminho interno/externo ajustado à base 768×1152 -->
        <path class="outline-path"
              d="M260 170 H508 L532 300 L592 1000
                 Q592 1088 384 1125 Q176 1088 176 1000
                 L236 300 Z"/>
      </svg>

      <!-- rótulos -->
      <div class="layer layer-labels">
        <div class="labelTop" id="labelTop">30</div>
        <div class="labelInside" id="labelInside">0,00</div>
        <div class="labelSide" id="labelSide">0%</div>
      </div>
    </div>
  </div>

  <!-- HUD -->
  <div class="hud">
    <button class="btn" id="zoomOut">−</button>
    <button class="btn" id="zoomReset">100%</button>
    <button class="btn" id="zoomIn">+</button>
    <button class="btn" id="reloadBtn">Recarregar</button>
    <span class="muted" id="stamp">—</span>
  </div>

<script>
  /* ===== CONFIG ===== */
  // seu CSV (mesmo gid=256356509)
  const DATA_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vR24Vx4SCLyGxtnD8X0tYOnBIZJ_Y10BYhYwaESp2Sui60TTEgC13hvPO8vKNtiMYp35L-A9LcGNmHB/pub?gid=256356509&output=csv";

  const PONTOS_MAX = 30;
  const AUTO_RELOAD_MIN = 5;     // minutos (0 = desliga)
  const PERCENT_DEFAULT = 0.446; // fallback (≈44,6%)
  const BASE_W = 768, BASE_H = 1152;

  // fit-to-screen + zoom
  let userZoom = 1.00, ZOOM_STEP = 0.08;
  function fit(){
    const vw = window.innerWidth, vh = window.innerHeight;
    const k  = Math.min(vw/BASE_W, vh/BASE_H) * userZoom;
    document.getElementById('box').style.transform = `scale(${k})`;
    document.getElementById('zoomReset').textContent = Math.round(userZoom*100) + '%';
  }
  function zoomIn(){ userZoom = Math.min(2.5, +(userZoom+ZOOM_STEP).toFixed(2)); fit(); }
  function zoomOut(){ userZoom = Math.max(0.5, +(userZoom-ZOOM_STEP).toFixed(2)); fit(); }
  function zoomReset(){ userZoom = 1.00; fit(); }
  window.addEventListener('resize', fit);
  document.getElementById('zoomIn').onclick  = zoomIn;
  document.getElementById('zoomOut').onclick = zoomOut;
  document.getElementById('zoomReset').onclick= zoomReset;
  document.getElementById('reloadBtn').onclick= load;
  window.addEventListener('keydown', e=>{
    if(e.key==='+') zoomIn();
    if(e.key==='-'||e.key==='−') zoomOut();
    if(e.key==='0') zoomReset();
    if(e.key.toLowerCase()==='r') load();
  });

  // CSV → percentual 0..1 (primeiro número; aceita vírgula)
  async function fetchPercent(){
    try{
      const url = DATA_CSV_URL + (DATA_CSV_URL.includes('?')?'&':'?') + 'cb=' + Date.now();
      const txt = await fetch(url).then(r=>r.text());
      const m = txt.match(/-?\d+(?:[.,]\d+)?/);
      const n = m ? parseFloat(m[0].replace(',','.')) : NaN;
      if (isFinite(n)) return Math.max(0, Math.min(1, n));
    }catch(_){}
    return null;
  }

  // posiciona rótulos e líquido
  function setLevel(p){
    p = Math.max(0, Math.min(1, p));
    const h = p*100; // %
    const liquid = document.getElementById('liquid');
    liquid.style.height = h + '%';

    // pontos no centro do azul
    const pts = (p*PONTOS_MAX).toFixed(2).replace('.', ',');
    const inside = document.getElementById('labelInside');
    inside.textContent = pts;
    inside.style.top = (100 - h/2) + '%'; // meio do líquido

    // topo (total)
    document.getElementById('labelTop').textContent = PONTOS_MAX;

    // lateral (linha d’água)
    const pct = (p*100).toFixed(2).replace('.', ',') + '%';
    const side = document.getElementById('labelSide');
    side.textContent = pct;
    side.style.top = (100 - h) + '%';

    // carimbo de horário
    const n=new Date(), two=x=>String(x).padStart(2,'0');
    document.getElementById('stamp').textContent =
      `Atualizado: ${two(n.getHours())}:${two(n.getMinutes())}`;
  }

  async function load(){
    const p = await fetchPercent();
    setLevel(p==null ? PERCENT_DEFAULT : p);
  }

  // start
  fit(); load();
  if (AUTO_RELOAD_MIN>0) setInterval(load, AUTO_RELOAD_MIN*60*1000);
</script>
</body>
</html>
